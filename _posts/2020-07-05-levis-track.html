---
layout: base
image: /images/music.png
seo: { "type": "MusicGroup" }
title: Levi's track
categories: ['music']
feed: { "excerpt_only": true }
excerpt: Remix of Attack on Titan's season two theme song, featuring a visualization with Levi Ackerman.
description: Remix of Attack on Titan's season two theme song, featuring a visualization with Levi Ackerman.
dark: true
style: >
  figure {
    margin: 0;
    padding: 0;
    position: relative;
  }
  img {
    width: 100%;
  }
  img.background {
    position: relative;
    transform: scale(.8);
  }
  img.foreground {
    position: absolute;
    top: 0;
    left: 0;
  }

---

<header>
  <figure>
    <img class="background" src="/images/levi-background.png" alt="The city of Trost (Attack on Titan)">
    <img class="foreground" src="/images/levi-foreground.png" alt="Captain Levi">
  </figure>
  <div align="center">
    <audio preload controls>
      <source src="/music/K0F1-Levi's Track.mp3" type="audio/mpeg">
    </audio>
  </div>
</header>

{% include footer.html %}

<script>
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  const audioContext = new AudioContext();

  const audio = document.querySelector("audio");
  const background = document.querySelector(".background");
  const foreground = document.querySelector(".foreground");
  const source = audioContext.createMediaElementSource(audio);
  const analyser = audioContext.createAnalyser();

  source.connect(analyser)
  source.connect(audioContext.destination);
  audio.addEventListener("play", () => audioContext.resume());

  analyser.fftSize = 256;
  const buffer = new Uint8Array(analyser.frequencyBinCount);
  (function loop() {
    requestAnimationFrame(loop);
    if (audio.paused) return;
    analyser.getByteTimeDomainData(buffer);
    let sum = 0;
    for (const x of buffer) sum += x;
    background.style.left = scale(sum / buffer.length, 256) + "%";
  })();

  document.addEventListener("mousemove", function(event) {
    foreground.style.left = scale(event.pageX, window.innerWidth ) + "%";
    foreground.style.top  = scale(event.pageY, window.innerHeight) + "%";
  });

  function scale(value, total) {
    return 2 * (.5 - value / total);
  }
</script>
